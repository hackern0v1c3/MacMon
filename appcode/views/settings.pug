extends navbar
block header
  meta(name="csrf-token" content=csrfToken)
  script(src='/js/settings.js') 
block selected
  -var selected = 'Settings';
block body
  form.form-horizonal.justify-content-center(action='/settings', method='post', style={margin: '0px 30px 30px 30px'}, autocomplete='off')
    h4 Version
    #{process.env.VERSION}
    hr
    h4 Local Time Zone
    strong#tzLabel UTC
    hr
    h4 Database Settings
    button#backupDatabaseButton.btn.btn-primary(type='button', enabled) Backup Database
    br
    br
    button#restoreDatabaseButton.btn.btn-primary(type='button', enabled) Restore Database
    br
    br
    .form-group
      label(for='dbAddressInput') Database Address
      input#dbAddressInput.form-control(type='text', name='dbAddress', value=process.env.DB_ADDRESS)
    .form-group
      label(for='dbPortInput') Database Port
      input#dbPortInput.form-control(type='text', name='dbPort', value=process.env.DB_PORT)
    .form-group
      label(for='dbUserInput') Database User
      input#dbUserInput.form-control(type='text', name='dbUser', value=process.env.DB_USER)
    .form-group
      label(for='dbNameInput') Database Name
      input#dbNameInput.form-control(type='text', name='dbName', value=process.env.DB_NAME)
    hr
    h4 Asset Types
    table#assetTypeTable.table.table-hover.table-sm(style={width: '30%'})
      each assetType in assetTypes
        tr
          td(id='assetid_'+assetType.ID)= assetType.Name
          td(align='right', style={width: '1%'})
            button.btn.btn-danger.removeAssetTypeButton(type='button', enabled) X
      tr
        td
          input#newAssetTypeInput.form-control(type='text', name='newAssetType')
        td
          button#newAssetTypeButton.btn.btn-primary(type='button', enabled) Add Asset Type
    hr
    h4 Scanner Settings
    .form-group
      label(for='CidrRangesInput') Scanner CIDR Ranges (Example: 192.168.1.0/24)
      table#cidrTable.table.table-hover.table-sm(style={width: '30%'})
        each range in conf.CidrRanges
          tr
            td= range
            td(align='right', style={width: '1%'})
              button.btn.btn-danger.removeCidrButton(type='button', enabled) X
        tr
          td
            input#newCidrInput.form-control(type='text', name='newRange')
          td
            button#newCidrButton.btn.btn-primary(type='button', enabled) Add New Range
    .form-group
      label(for='scanIntervalInput') Scanner Frequency in Seconds
      input#scanIntervalInput.form-control(type='text', name='scanInterval', value=conf.scanInterval)
    hr
    h4 Email Settings
    .form-group
      label(for='emailNotificationsInput') Enable Email Notifications 
        input#emailNotificationsInput.form-control(type='checkbox', name='emailNotifications', checked=(conf.emailNotifications === 'True' || conf.emailNotifications === 'true'))
    .form-group
      label(for='emailServerInput') Email Server Address
      input#emailServerInput.form-control(type='text', name='emailServer', value=conf.emailServer)
    .form-group
      label(for='smtpPortInput') Email Server SMTP Port
      input#smtpPortInput.form-control(type='text', name='smtpPort', value=conf.smtpPort)
    .form-group
      label(for='emailSenderInput') Email Address for Sending Notifications
      input#emailSenderInput.form-control(type='text', name='emailSender', value=conf.emailSender)
    .form-group
      label(for='emailSenderUsernameInput') Email Server Username
      input#emailSenderUsernameInput.form-control(type='text', name='emailSenderUsername', value=conf.emailSenderUsername)
    .form-group
      label(for='emailRecipientInput') Email Address for Receiving Notifications
      input#emailRecipientInput.form-control(type='text', name='emailRecipient', value=conf.emailRecipient)
    .form-group
      label(for='emailTlsInput') Email Server Requires TLS 
        input#emailTlsInput.form-control(type='checkbox', name='emailTls', checked=(conf.emailTls === 'True' || conf.emailTls === 'true')) 
    .form-group
      label Email Password
      input#emailPassword1.form-control(type='password', name='password', autocomplete='off')
    .form-group
      label Confirm Email Password
      input#emailPassword2.form-control(type='password', name='confirmPassword', autocomplete='off')
    br
    br
    button#testEmailButton.btn.btn-primary(type='button', enabled) Test Email Settings
    hr
    button#editSettingsSubmitButton.btn.btn-success(type='button', enabled) Save

  //Modal for restoring database
  #databaseRestoreModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='databaseRestoreModalLabel', aria-hidden='true')
    .modal-dialog(role='document')
      .modal-content
        .modal-header
          h5#databaseRestoreModalLabel.modal-title Please select a restore point
          button.close(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') &times;
        .modal-body
          form.form-horizonal.justify-content-center(action='/dbbackup', method='post')
            .form-group
              label Restore Points
              select#databaseRestoreSelection.select.form-control
                option(value='0', selected= true) -- Select --
            button#databaseRestoreSubmitButton.btn.btn-success(type='button', enabled) Submit

  //Modal for save confirmation
  #saveConfirmModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='saveConfirmModalLabel', aria-hidden='true')
    .modal-dialog(role='document')
      .modal-content
        .modal-header
          h5#saveConfirmModal.modal-title Save Succesful
          button.close(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') &times;
        .modal-body
          label Save Succesful.
        .modal-footer
          button.btn.btn-primary(data-dismiss="modal") Close